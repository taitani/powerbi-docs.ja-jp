---
title: "Power BI Desktop におけるレポート作成のヒントとテクニック"
description: "Power BI Desktop におけるレポート作成のヒントとテクニック"
services: powerbi
documentationcenter: 
author: davidiseminger
manager: kfile
backup: 
editor: 
tags: 
qualityfocus: identified
qualitydate: 
ms.service: powerbi
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: powerbi
ms.date: 07/20/2017
ms.author: davidi
ms.openlocfilehash: f157a5efad5af44d4b97149c379211695800cfd9
ms.sourcegitcommit: 8f72ce6b35aa25979090a05e3827d4937dce6a0d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/27/2017
---
# <a name="tips-and-tricks-for-creating-reports-in-power-bi-desktop"></a>Power BI Desktop におけるレポート作成のヒントとテクニック
データを最大限に活用するには、少しのヒントが必要な場合があります。 Microsoft Power BI Desktop でレポートを作成する場合、*および* Power Pivot のアドインを有効にし、なおかつ Power Query をインストールして有効にした Microsoft Excel 2016 または Excel 2013 Pro-Plus エディションでレポートを作成する場合に役立つヒントとテクニックをまとめました。 

## <a name="learning-to-use-the-query-editor"></a>クエリ エディターの使用方法
Power BI Desktop のクエリ エディターは、Excel 2013 の Power Query アドイン機能に似ています。 Power BI サポートにも役立つ記事がありますが、support.office.com にある Power Query に関する資料を最初に読まれることをお勧めします。

[Power Query リソース センター](https://support.office.com/article/Microsoft-Power-Query-for-Excel-Help-2b433a85-ddfb-420b-9cda-fe0e60b82a94)から追加情報を取得できます。

また、[式の参照](https://support.office.com/Article/Learn-about-Power-Query-formulas-6bc50988-022b-4799-a709-f8aafdee2b2f)を表示することもできます。

## <a name="data-types-in-query-editor"></a>クエリ エディターのデータ型
Power BI Destop でクエリ エディターを使用するときには、最善の推測によってデータ型の検出が行われます。  数式を使用する場合、列にデータ型の設定が保持されないことがあります。 データを初めてクエリ タブに読み込んだ後、先頭行を見出しとして設定した後、列を追加した後、Group by の後、Merge の後、Append の後、データを初めて読み込む前には、列のデータ型が正しいことをご確認ください。

データ グリッド内の斜体部分はデータ型が正しく設定されていることを表しているのではなく、単にテキストとして扱われないことを意味しているということを忘れないでください。

## <a name="reference-queries-in-the-query-editor"></a>クエリ エディターでのクエリの参照
クエリ エディターのナビゲーターでいずれかのクエリを右クリックすると、「参照」用として指定できるオプションが表示されます。  これは、次の理由により便利です。

* クエリのデータ ソースとしてファイルを使用すると、ファイルの絶対パスがクエリに保存されます。 Power BI Desktop ファイルまたは Excel ブックを共有または移動するときは、パスを 1 つ 1 つ更新するよりも、Power BI Desktop ファイルまたは Excel ブックを 1 回だけ更新してパスを更新する方が時間を短縮できます。

既定では、すべてのクエリが Excel ワークシートまたはデータ モデル (あるいはその両方) に読み込まれます。 一部のクエリは中間的な手順であり、エンドユーザー向けのものではありません。  既に説明したように、クエリを参照する場合は、その多くがこれに該当します。  クエリの読み込み動作を制御するには、ナビゲーターでクエリを右クリックし、[読み込みを有効にする] オプションを切り替えます。  [読み込みを有効にする] の横にチェック マークが表示されない場合、そのクエリはクエリ タブで引き続き使用可能であり、他のクエリとともに使用できます。  特に、Merge、Append、および Reference 変換と組み合わせて使用すると便利です。  ただしクエリの結果はデータ モデルに読み込まれないため、クエリがレポートのフィールドの一覧やデータ モデルを乱雑にすることはありません。 

## <a name="scatter-charts-need-a-point-identifier"></a>散布図にはポイント識別子が必要
一例として、気温と時刻の単純なテーブルがあり、これらの値を読み取ったとしましょう。 これを散布図に直接プロットする場合、Power BI Desktop はすべての値を 1 点に集約します。 個々のデータ ポイントを表示するためには、フィールド内の詳細バケットにフィールドを追加します。   クエリ タブでこれを簡単に追加するには、[列の追加] リボンの [インデックス列の追加] オプションを使用します。 

## <a name="reference-lines-in-your-report"></a>レポート内の参照行
計算列を使用すると、参照行を定義できます。  参照行を作成するテーブルと列を識別します。  リボンで [新しい列] を選択し、数式バーに次の数式を入力します。

    Target Value = 100

この計算列は、使用されている場所に関係なく、値 100 を返します。  フィールドの一覧に新しい列が表示されます。  [ターゲット値] 計算列を折れ線グラフに追加すると、一連の値と特定の参照行との関連性がわかります。  

## <a name="sort-by-another-column"></a>別の列を基準とした並べ替え
カテゴリ別 (文字列) の値を Power BI Desktop でグラフの軸に使用する場合、またはスライサーやフィルターで使用する場合、既定の順序はアルファベット順です。 曜日や月の名前のように、アルファベット順をオーバーライドする必要がある場合は、Power BI Desktop に別の列を基準に並べ替えるように指示します。詳細については、「[Power BI Desktop における列による並べ替え](desktop-sort-by-column.md)」をご覧ください。

## <a name="building-maps-more-easily-with-hints-to-bing"></a>Bing にヒントを与えることでより簡単にマップを作成
Power BI は Bing と統合されており、既定のマップ座標 (ジオコーディングと呼ばれるプロセス) を提供するため、マップを簡単に作成できます。  Bing はいくつかのアルゴリズムとヒントを使用して適切な場所を取得しようとしますが、あくまでも最善の推測に過ぎません。   ジオコーディングの正確性を高めるために、次のヒントを使用してください。

マップを作成するとき、国、都道府県、市区町村をプロットすることがよくあります。  住所指定の後に名前の列を使用すると、Bing による推測結果の正確性が増します。 たとえば、「カリフォルニア」や「ワシントン」などの米国の州名を入力するフィールドがある場合、Bing は「ワシントン」という語からワシントン州ではなくワシントン DC を返す可能性があります。  この列に「州」という名前を付けておけば、ジオコーディングが改善されます。  同様に、列には「国」、「都道府県」、「市区町村」のように名前を付けます。   

この指定は、複数の国や地域のコンテキストではあいまいになることもあります。  国や地域によっては、「州」と呼ばれるものが、「都道府県」や「郡」などと呼ばれる場合があります。  ジオコーディングの正確性を増すには、作成する列に複数のフィールドを追加し、それらのフィールドをデータの場所のプロットに使用します。  たとえば、"Wiltshire" という値のみを渡すのではなく、"Wiltshire, England" という値を渡せば、ジオコーディング結果の正確性が高まります。 

これにより、特定の緯度と経度を組み合わせた場所を必ず提供できるようになります。  このとき、場所のフィールドも渡しておかないと、データが既定どおりに集約されるため、緯度と経度で示される場所が期待どおりの場所でなくなる可能性があります。

## <a name="categorizing-geographic-fields-to-hint-bings-geocoding"></a>Bing のジオコーディングにヒントを与える地理的フィールドの分類
Power BI Desktop では、データ フィールドにデータ カテゴリを設定しておくと、フィールドを正確にジオコーディングできます。   Power BI Desktop で目的のテーブルを選択し、[詳細設定] リボンに移動し、データ カテゴリを [住所]、[市区町村]、[大陸]、[国/地域]、[国]、[郵便番号]、または [都道府県] に設定します。  これらのデータ カテゴリを基に Bing はデータを正しくエンコードできます。詳細については、「[Power BI Desktop でのデータ分類](desktop-data-categorization.md)」をご覧ください。

## <a name="better-geocoding-with-more-specific-locations"></a>ジオコーディングの正確性を増すために場所を詳細に指定
マッピング用のデータ カテゴリの設定だけでは不十分な場合があります。  Power BI Desktop のクエリ エディターを使用すると、クエリ内に番地などの詳細な場所指定を作成できます。  [列の追加] 機能を使用して、カスタム列を作成します。  その後、次のように必要な場所指定を作成します。 

    = [Field1] & " " & [Field2]

この結果のフィールドをマップ表示で使用します。 これは、データ セットの共通フィールドである [配送先住所] フィールドから [番地] を作成するときに非常に便利です。  注意しなければならないのは、連結がテキスト フィールドにしか機能しない点です。  必要に応じて、番地をテキスト データ型に変換してから、住所の作成に使用してください。

## <a name="histograms-in-the-query-stage"></a>クエリ ステージのヒストグラム
ヒストグラムはいくつかの方法で作成できます。まずは最も単純な方法から始めましょう。

最も単純なヒストグラム - ヒストグラム作成の基準とするフィールドが含まれているクエリを判別します。  クエリの [参照] オプションを使用して、新しいクエリを作成し、"FieldName Histogram" という名前を付けます。 [変換] リボンの [グループ化] オプションを使用し、[行のカウント] 集計を選択します。  結果の集計列のデータ型が数値であることを確認してください。 その後、このデータをレポート ページで視覚化します。  これは短時間で簡単に作成できますが、データ ポイントの数が多い場合はうまく機能せず、ビジュアル間でのブラッシングは許可されません。

バケットを定義してヒストグラムを作成 - ヒストグラム作成の基準とするフィールドが含まれているクエリを判別します。  クエリの [参照] オプションを使用して、新しいクエリを作成し、"FieldName" という名前を付けます。  ルールを使用してバケットを定義します。  [列の追加] リボンの [カスタム列の追加] オプションを使用し、カスタム ルールを作成します。  次に、バケットの単純なルールの例を示します。

    if([FieldName] \< 2) then "\<2 min" else
    if([FieldName] \< 5) then "\<5 min" else
    if([FieldName] \< 10) then "\<10 min" else
    if([FieldName] \< 30) then "\<30 min" else
    "longer")

結果の集計列のデータ型が数値であることを確認してください。 「最も単純なヒストグラム」で説明した手法でグループを使用して、ヒストグラムを完成させます。  このオプションでは、より多くのデータ ポイントを処理しますが、ブラッシングはやはり使用できません。

ブラッシングをサポートするヒストグラムを定義 - ブラッシングとは、ビジュアルが相互リンクされている状態を表します。つまり、あるビジュアルでユーザーがデータ ポイントを選ぶと、レポート ページの他のビジュアルでは、選ばれたデータ ポイントに関連するデータ ポイントが強調表示またはフィルター処理されます。  クエリ時にはデータを操作するので、テーブル間のリレーションシップを作成し、どの詳細項目がヒストグラムのバケットに関連するか、またその逆方向の関連性を把握しておく必要があります。

プロセスを開始するため、ヒストグラム作成の基準とするフィールドが含まれているクエリの「参照」オプションを使用します。  新しいクエリに "Buckets" という名前を付けます。  この例では元のクエリを "Details" と呼ぶことにしましょう。  次に、ヒストグラムのバケットとして使用する列以外の列をすべて削除します。  その後、クエリの [重複の削除] 機能を使用します。この機能は、列を選択したときに右クリック メニューとして表示されます。そのため、列では残りの値は固有の値になります。   10 進数がある場合は、「バケットを定義してヒストグラムを作成」のヒントを使用すると、管理可能なバケットのセットを取得できます。  ここで、クエリのプレビューに表示されるデータを確認します。  空白の値または null が表示される場合は、それらを修正してからリレーションシップを作成する必要があります。  「データに null または空白の値が含まれている場合のリレーションシップの作成」を参照してください。   この方法では並べ替えが必要となるため、問題が生じる可能性があります。  バケットを正しく並べ替えるには、「並べ替えの順序: カテゴリを必要な順序で表示」を参照してください。  

>[!NOTE]
>ビジュアルを作成する前に並べ替え順序を考えておくことをお勧めします。   

プロセスの次の手順では、バケットの列で "Buckets" クエリと "Details" クエリのリレーションシップを定義します。  Power BI Desktop のリボンで **[リレーションシップ管理]** をクリックします。  "Buckets" が左側のテーブル、"Details" が右側のテーブルに表示されるリレーションシップを作成し、ヒストグラムに使用するフィールドを選択します。 

最後の手順は、ヒストグラムの作成です。  "Buckets" テーブルから [バケット] フィールドをドラッグします。  結果として得られる縦棒グラフから、既定のフィールドを削除します。  その後、"Details" テーブルのヒストグラム フィールドを同じビジュアルまでドラッグします。  このフィールドで、既定の集計を [カウント] に変更します。  これでヒストグラムの完成です。 ツリーマップのようなビジュアルを "Details" テーブルから作成する場合は、ツリーマップのデータ ポイントを選択して、ヒストグラムの強調表示を確認し、データ シート全体の傾向に関連する選択済みデータ ポイントのヒストグラムを表示します。

## <a name="histograms"></a>ヒストグラム
計算フィールドを使用して、ヒストグラムを定義できます。  ヒストグラム作成の基準とするテーブルと列を識別します。  計算領域で、次の数式を入力します。

> Frequency:=COUNTROWS(\<Column Name\>)
> 
> 

変更を保存し、レポートに戻ります。  \<Column Name\> と Frequency をテーブルに追加してから、横棒グラフに変換します。  \<Column Name\> は x 軸、計算済みの Frequency フィールドは y 軸です。

## <a name="tips-and-tricks-for-creating-relationships"></a>リレーションシップの作成に関するヒントとテクニック
複数のソースから詳細なデータ セットを読み込むと、多くの場合、null 値、空白値、または重複する値などが問題となってリレーションシップを作成できません。 

例を見てみましょう。 

アクティブなカスタマー サポート要求からデータ セットを読み込み、スキーマを含む作業項目の別のデータ セットをさらに読み込む場合は、次のようになります。

> CustomerInicdents: {IncidentID, CustomerName, IssueName, OpenedDate, Status} WorkItems: {WorkItemID, IncidentID, WorkItemName, OpenedDate, Status, CustomerName } 
> 
> 

特定のカスタマー名 (CustomerName) に関連するすべてのインシデント (Incident) と作業項目 (WorkItem) を追跡する場合、これらの 2 つのデータ セット間のリレーションシップは簡単には作成できません。  一部の WorkItem が CustomerName に関連していない可能性があり、そのフィールドは空白または null になります。  特定の CustomerName の WorkItem と CustomerIncident に複数のレコードが存在する場合があります。  

### <a name="creating-relationships-when-the-data-has-null-or-blank-values"></a>データに null または空白の値が含まれている場合のリレーションシップの作成
データのセットには多くの場合、null または空白の値を持つ列が含まれています。  これにより、リレーションシップを使用しようとすると、問題が発生することがあります。  この問題に対処するためのオプションは、基本的に 2 つあります。  1 つ目のオプションは、null または空白の値を持つ行を削除する方法です。  削除するには、クエリ タブでフィルター機能を使用します。また、クエリをマージしている場合は、[一致する行だけを保持する] オプションを選択します。 2 つ目のオプションは、null または空白の値を、リレーションシップで機能する値 (一般的には "NULL" や "(Blank)" などの文字列) に置き換える方法です。   この時点で適切なアプローチがない - クエリ ステージにおいて行をフィルターで除外すると、行が削除され、概要統計情報や計算に影響を及ぼす可能性があります。  後者のアプローチでは、そのデータ行が保持されますが、関連のない行がモデルに関連するように見える可能性があるため、計算ミスにつながります。  後者のソリューションを採用する場合は、必要に応じてビューやグラフでフィルター処理を使用して、正確な結果が得られていることを確認してください。  最も重要なのは、どの行を保持し、どの行を削除するかを評価すること、および分析への全体的な影響を理解することです。  

### <a name="creating-relationships-when-the-data-has-duplicate-values"></a>データに重複する値が含まれている場合のリレーションシップの作成
複数のソースから詳細なデータ セットを読み込むと、多くの場合、重複する値が原因となってリレーションシップを作成できません。  この問題を克服するには、両方のデータ セットの一意の値を使用してディメンション テーブルを作成します。 

例を見てみましょう。 

アクティブなカスタマー サポート要求からデータ セットを読み込み、スキーマを含む作業項目の別のデータ セットをさらに読み込む場合は、次のようになります。

> CustomerInicdents: {IncidentID, CustomerName, IssueName, OpenedDate, Status} WorkItems: {WorkItemID, IncidentID, WorkItemName, OpenedDate, Status, CustomerName } 
> 
> 

特定のカスタマー名 (CustomerName) に関連するすべてのインシデント (Incident) と作業項目 (WorkItem) を追跡する場合、これらの 2 つのデータ セット間のリレーションシップは簡単には作成できません。  一部の WorkItem が CustomerName に関連していない可能性があり、そのフィールドは空白または null になります。  CustomerNames テーブルに空白の値または null が含まれている場合にも、リレーションシップを作成できません。「データに null または空白の値が含まれている場合のリレーションシップの作成」を参照してください。  1 つの CustomerName に複数の WorkItem と CustomerIncident が存在する場合があります。  

この場合、リレーションシップを作成するには、2 つのデータ セットのすべての CustomerName の論理データ セットを作成する必要があります。  論理データ セットを作成するには、[クエリ] タブで次のシーケンスを使用します。

1. 両方のクエリを複製し、最初のクエリに **Temp** 、2 番目のクエリに **CustomerNames**という名前を付けます。
2. 各クエリで、CustomerName 列 *以外* のすべての列を削除します。
3. 各クエリで  **[重複を削除]**を使用します。
4. **CustomerNames** クエリで、リボンの **[追加]** オプションを選択し、 **Temp**クエリを選択します。
5. **CustomerNames** クエリで **[重複を削除]**を選択します。

これで、相互にすべての値を含む CustomerIndicents と WorkItems を関連付けるために使用できるディメンション テーブルが作成されました。  

## <a name="patterns-to-jump-start-your-use-of-the-query-editor"></a>クエリ エディターの使用をジャンプ スタートできるパターン
クエリ エディターは非常に強力なツールで、整形するデータを操作したり、クリーンアップして視覚化またはモデル化に備えたりすることができます。 覚えておくべきパターンがいくつかあります。

### <a name="temporary-columns-can-be-deleted-after-computing-a-result"></a>結果の計算後に一時的な列を削除可能
多くの場合、複数の列のデータを 1 つの新しい列に変換する計算を作成する必要があります。  これは複雑な計算になる可能性があります。  この問題を解決するための簡単な方法の 1 つは、操作を複数の手順に分解する方法です。  まずは最初の列を複製します。 次に、手順を一時列に作成します。 さらに、最終的な結果の列を作成します。  ここで一時列を削除しておけば、最終的なデータ セットは乱雑になりません。 これが可能なのは、クエリ タブでは手順が順序どおり実行されるからです。 

### <a name="duplicate-or-reference-queries-followed-by-merge-to-original-query"></a>クエリの複製または参照の後に元のクエリへのマージを実行
データ セットの概要統計情報を計算すると便利な場合があります。  この計算を簡単に実行するには、クエリ タブでクエリを複製または参照します。その後、 **[グループ化]** を使用して、概要統計情報を計算します。  元のデータ内のデータを正規化して、それらが比較可能になるようにする上で、概要統計情報は役立ちます。  これは特に、個々の値を全体と比較する場合に役立ちます。  これを行うには、元のクエリに移動し、マージ オプションを選択します。  その後、適切な識別子に一致する概要統計情報クエリからデータをマージします。  これで、分析に必要な場合にデータを正規化する準備ができました。

## <a name="using-dax-for-the-first-time"></a>DAX を初めて使用する場合
DAX は、Power BI Desktop で使用される計算式言語です。  それは BI の分析のために最適化されています。  これまでに使ったことがある言語が SQL のようなクエリ言語のみの場合、使用感が若干異なります。 DAX を学習するための非常に優れたリソースがオンラインにも出版物としても存在します。 

[クイック スタート: Power BI Desktop における DAX の基本事項](desktop-quickstart-learn-dax-basics.md)

[Data Analysis Expressions (DAX) リファレンス](https://msdn.microsoft.com/library/gg413422.aspx)

[DAX リソース センター](http://social.technet.microsoft.com/wiki/contents/articles/1088.dax-resource-center.aspx)

